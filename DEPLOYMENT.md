# Vercel Deployment Guide

This guide will help you deploy the AnymeX Theme Marketplace to Vercel with Vercel Postgres.

## Prerequisites

- Vercel account ([sign up](https://vercel.com/signup))
- GitHub account (your code should be on GitHub)
- Vercel Postgres database (included in Pro plan or can be added separately)

## Step 1: Set Up Vercel Postgres

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Create a new project or select existing project
3. Go to **Storage** → **Create Database**
4. Select **Postgres** and click **Continue**
5. Choose a region (e.g., US East) and click **Continue**
6. Click **Create Database**
7. Wait for the database to be created (usually 1-2 minutes)
8. Once created, click on the database and copy the **Connection String** (DATABASE_URL)

## Step 2: Configure Environment Variables

### Option A: Using Vercel CLI

```bash
vercel env add DATABASE_URL
```

When prompted, paste your Vercel Postgres connection string.

### Option B: Using Vercel Dashboard

1. Go to your project in Vercel Dashboard
2. Click on **Settings** → **Environment Variables**
3. Add new variable:
   - Name: `DATABASE_URL`
   - Value: Your Vercel Postgres connection string
   - Environment: All (Production, Preview, Development)
4. Click **Save**

## Step 3: Deploy to Vercel

### Option A: Using Vercel CLI

```bash
# Install Vercel CLI
bun add -g vercel

# Deploy
vercel
```

### Option B: Using Vercel Dashboard

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click **Add New Project**
3. Import your GitHub repository
4. Configure project:
   - Framework Preset: Next.js
   - Root Directory: `./`
   - Build Command: `bun run build`
   - Output Directory: `.next`
   - Install Command: (leave empty for bun)
5. Add environment variables:
   - `DATABASE_URL` = Your Vercel Postgres connection string
6. Click **Deploy**

## Step 4: Run Database Migrations

After deployment, you need to create the database schema:

```bash
# Connect to your Vercel Postgres database
# Use the connection string from your Vercel dashboard

# Run Prisma migration
bunx prisma migrate deploy
```

Or use Vercel Postgres Dashboard to run SQL:

```sql
-- Create tables based on your Prisma schema
-- This will be auto-generated by Prisma, but you can also run it manually
```

## Local Development with Vercel Postgres

If you want to use Vercel Postgres for local development:

1. Create `.env.local` file (this file is gitignored)
2. Add your Vercel Postgres connection string:
   ```
   DATABASE_URL=postgres://USER:PASSWORD@HOST:PORT/DATABASE?sslmode=require
   ```
3. Run migrations:
   ```bash
   bun run db:push
   ```

## Environment Variables

### Required

| Variable | Description | Example |
|-----------|-------------|----------|
| `DATABASE_URL` | PostgreSQL connection string | `postgres://user:pass@host:port/db?sslmode=require` |

### Optional

| Variable | Description | Default |
|-----------|-------------|----------|
| `NODE_ENV` | Environment | `production` (set by Vercel automatically) |

## Troubleshooting

### Database Connection Errors

**Error:** `PrismaClientInitializationError`

**Solution:**
- Check that `DATABASE_URL` is set correctly in Vercel Dashboard
- Ensure the database is created in Vercel Dashboard
- Verify the connection string is correct

### Migration Errors

**Error:** `P3014: The migration was not applied`

**Solution:**
```bash
# Reset and re-run migrations (development only)
bun run db:reset
bun run db:push
```

### Build Errors

**Error:** `Module not found: Can't resolve '@/lib/db'`

**Solution:**
- Ensure all imports are using the correct path aliases
- Check `tsconfig.json` paths configuration

### Runtime Errors

**Error:** `502 Bad Gateway`

**Solution:**
- Check server logs in Vercel Dashboard
- Verify database connection is working
- Ensure all environment variables are set

## Vercel-Specific Considerations

### Serverless Functions

Vercel uses serverless functions which have:
- **Maximum execution time:** 60 seconds
- **Cold starts:** First request may be slower
- **Memory limits:** Depends on plan

### Database Connection Pooling

Vercel Postgres uses connection pooling automatically. The connection string includes pooling parameters.

### Prisma Accelerate

For better performance, consider using Prisma Accelerate:

1. Create a Prisma Cloud account
2. Generate Accelerate connection string
3. Update `DATABASE_URL` to use Accelerate endpoint

## Monitoring

- **Vercel Dashboard:** View logs, deployments, and analytics
- **Vercel Postgres:** Monitor database connections and performance
- **Prisma Studio:** Visual database management (local only)

## Next Steps

After successful deployment:

1. Test your application at the Vercel URL
2. Verify database operations work (create theme, search, like)
3. Set up custom domain in Vercel Dashboard
4. Configure analytics (Vercel Analytics, Google Analytics, etc.)

## Support

- [Vercel Documentation](https://vercel.com/docs)
- [Vercel Postgres Documentation](https://vercel.com/docs/storage/vercel-postgres)
- [Prisma Documentation](https://www.prisma.io/docs)
